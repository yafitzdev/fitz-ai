# fitz/vector_db/plugins/qdrant.yaml

name: qdrant
type: vector_db
description: Qdrant vector database - supports local and cloud deployments

connection:
  type: http
  base_url: "http://{{host}}:{{port}}"
  default_host: localhost
  default_port: 6333
  auth:
    type: bearer
    env_var: QDRANT_API_KEY
    header: api-key
    optional: true  # API key is optional for local deployments

operations:
  # Search for similar vectors
  search:
    endpoint: /collections/{{collection}}/points/search
    method: POST
    body:
      vector: "{{query_vector}}"
      limit: "{{limit}}"
      with_payload: "{{with_payload}}"

    response:
      results_path: result
      mapping:
        id: id
        score: score
        payload: payload

  # Insert or update points
  upsert:
    endpoint: /collections/{{collection}}/points
    method: PUT

    # Auto-create collection if it doesn't exist
    auto_create_collection: true
    create_collection_endpoint: /collections/{{collection}}
    create_collection_method: PUT
    create_collection_body:
      vectors:
        size: "{{vector_dim}}"
        distance: Cosine

    body:
      points: "{{points}}"

    # No transformation needed - standard format matches Qdrant
    point_transform:
      identity: true

  # Delete entire collection
  delete_collection:
    endpoint: /collections/{{collection}}
    method: DELETE
    response:
      success_codes: [200, 404]  # 404 = already deleted, that's fine

  # List all collections
  list_collections:
    endpoint: /collections
    method: GET
    response:
      collections_path: result.collections
      name_field: name

  # Get collection statistics
  get_stats:
    endpoint: /collections/{{collection}}
    method: GET
    response:
      stats_path: result