# fitz_ai/llm/schemas/embedding_plugin_schema.yaml
#
# MASTER SCHEMA: All fields for embedding plugins
# ================================================
#
# This is the SINGLE SOURCE OF TRUTH for embedding plugin fields.
# - All embedding plugin YAML files must follow this structure
# - Code reads defaults from here
# - Add new fields HERE first
#
# Field definition format:
#   field_name:
#     required: true/false
#     type: string/integer/float/boolean/list/object
#     default: <value> (only if required=false)
#     options: [...] (optional, restricts allowed values)
#     description: "..."
#     example: <value>

fields:

  # ============================================================================
  # IDENTITY
  # ============================================================================

  plugin_name:
    required: true
    type: string
    description: "Unique plugin identifier"
    example: "openai"

  plugin_type:
    required: true
    type: string
    options: ["embedding"]
    description: "Must be 'embedding' for embedding plugins"
    example: "embedding"

  version:
    required: false
    type: string
    default: "1.0"
    description: "Plugin schema version"
    example: "1.0"

  # ============================================================================
  # PROVIDER
  # ============================================================================

  provider.name:
    required: true
    type: string
    description: "Provider name for credential lookup"
    example: "openai"

  provider.base_url:
    required: true
    type: string
    description: "API base URL (can contain {placeholders})"
    example: "https://api.openai.com/v1"

  # ============================================================================
  # AUTHENTICATION
  # ============================================================================

  auth.type:
    required: false
    type: string
    default: "bearer"
    options: ["bearer", "header", "query", "none"]
    description: "Authentication method"
    example: "bearer"

  auth.header_name:
    required: false
    type: string
    default: "Authorization"
    description: "HTTP header name for auth token"
    example: "Authorization"

  auth.header_format:
    required: false
    type: string
    default: "Bearer {key}"
    description: "Header value format. {key} replaced with API key"
    example: "Bearer {key}"

  auth.env_vars:
    required: false
    type: list
    default: []
    description: "Environment variable names to check for API key"
    example: ["OPENAI_API_KEY"]

  # ============================================================================
  # REQUIRED ENVIRONMENT VARIABLES (for Azure, etc.)
  # ============================================================================

  required_env:
    required: false
    type: list
    default: []
    description: "Additional required env vars (each item has: name, inject_as, default)"
    example: []

  # ============================================================================
  # HEALTH CHECK (for local services like Ollama)
  # ============================================================================

  health_check:
    required: false
    type: object
    default: null
    description: "Optional health check config for local services"

  health_check.path:
    required: false
    type: string
    default: "/health"
    description: "Health check endpoint path"

  health_check.method:
    required: false
    type: string
    default: "GET"
    options: ["GET", "POST"]
    description: "HTTP method for health check"

  health_check.timeout:
    required: false
    type: integer
    default: 2
    description: "Health check timeout in seconds"

  # ============================================================================
  # ENDPOINT
  # ============================================================================

  endpoint.path:
    required: true
    type: string
    description: "API endpoint path"
    example: "/embeddings"

  endpoint.method:
    required: false
    type: string
    default: "POST"
    options: ["GET", "POST", "PUT", "DELETE"]
    description: "HTTP method"

  endpoint.timeout:
    required: false
    type: integer
    default: 30
    description: "Request timeout in seconds"

  # ============================================================================
  # DEFAULTS
  # ============================================================================

  defaults.model:
    required: false
    type: string
    default: null
    description: "Default model name"
    example: "text-embedding-3-small"

  defaults.input_type:
    required: false
    type: string
    default: null
    description: "Input type hint (Cohere uses this)"
    example: "search_document"

  # ============================================================================
  # REQUEST CONFIGURATION
  # ============================================================================

  request.input_field:
    required: false
    type: string
    default: "input"
    description: "Field name for input text in request body"
    example: "input"

  request.input_wrap:
    required: false
    type: string
    default: "list"
    options: ["list", "string", "object"]
    description: "How to wrap input text (list=[text], string=text, object={text:text})"
    example: "list"

  request.static_fields:
    required: false
    type: object
    default: {}
    description: "Fields always included in request body"
    example: {}

  request.param_map:
    required: false
    type: object
    default:
      model: "model"
    description: "Maps Fitz parameter names to provider parameter names"
    example:
      model: "model"
      input_type: "input_type"
      dimensions: "dimensions"

  # ============================================================================
  # RESPONSE CONFIGURATION
  # ============================================================================

  response.embeddings_path:
    required: true
    type: string
    description: "JSONPath to extract embedding vector from API response"
    example: "data[0].embedding"

  response.is_array:
    required: false
    type: boolean
    default: true
    description: "Whether embeddings_path returns an array"

  response.array_index:
    required: false
    type: integer
    default: 0
    description: "Index to use if embeddings_path returns array of embeddings"