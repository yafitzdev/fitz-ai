# fitz_ai/llm/schemas/chat_plugin_schema.yaml
#
# MASTER SCHEMA: All fields for chat plugins
# ============================================
#
# This is the SINGLE SOURCE OF TRUTH for chat plugin fields.
# - All chat plugin YAML files must follow this structure
# - Code reads defaults from here
# - Add new fields HERE first
#
# Field definition format:
#   field_name:
#     required: true/false
#     type: string/integer/float/boolean/list/object
#     default: <value> (only if required=false)
#     options: [...] (optional, restricts allowed values)
#     description: "..."
#     example: <value>

fields:

  # ============================================================================
  # IDENTITY
  # ============================================================================

  plugin_name:
    required: true
    type: string
    description: "Unique plugin identifier"
    example: "openai"

  plugin_type:
    required: true
    type: string
    options: ["chat"]
    description: "Must be 'chat' for chat plugins"
    example: "chat"

  version:
    required: false
    type: string
    default: "1.0"
    description: "Plugin schema version"
    example: "1.0"

  # ============================================================================
  # PROVIDER
  # ============================================================================

  provider.name:
    required: true
    type: string
    description: "Provider name for credential lookup"
    example: "openai"

  provider.base_url:
    required: true
    type: string
    description: "API base URL (can contain {placeholders})"
    example: "https://api.openai.com/v1"

  # ============================================================================
  # AUTHENTICATION
  # ============================================================================

  auth.type:
    required: false
    type: string
    default: "bearer"
    options: ["bearer", "header", "query", "none"]
    description: "Authentication method"
    example: "bearer"

  auth.header_name:
    required: false
    type: string
    default: "Authorization"
    description: "HTTP header name for auth token"
    example: "Authorization"

  auth.header_format:
    required: false
    type: string
    default: "Bearer {key}"
    description: "Header value format. {key} replaced with API key"
    example: "Bearer {key}"

  auth.env_vars:
    required: false
    type: list
    default: []
    description: "Environment variable names to check for API key"
    example: ["OPENAI_API_KEY"]

  # ============================================================================
  # REQUIRED ENVIRONMENT VARIABLES (for Azure, etc.)
  # ============================================================================

  required_env:
    required: false
    type: list
    default: []
    description: "Additional required env vars (each item has: name, inject_as, default)"
    example:
      - name: "AZURE_OPENAI_ENDPOINT"
        inject_as: "endpoint"
        default: null

  # ============================================================================
  # HEALTH CHECK (for local services like Ollama)
  # ============================================================================

  health_check:
    required: false
    type: object
    default: null
    description: "Optional health check config for local services"

  health_check.path:
    required: false
    type: string
    default: "/health"
    description: "Health check endpoint path"
    example: "/api/tags"

  health_check.method:
    required: false
    type: string
    default: "GET"
    options: ["GET", "POST"]
    description: "HTTP method for health check"

  health_check.timeout:
    required: false
    type: integer
    default: 2
    description: "Health check timeout in seconds"

  # ============================================================================
  # ENDPOINT
  # ============================================================================

  endpoint.path:
    required: true
    type: string
    description: "API endpoint path"
    example: "/chat/completions"

  endpoint.method:
    required: false
    type: string
    default: "POST"
    options: ["GET", "POST", "PUT", "DELETE"]
    description: "HTTP method"

  endpoint.timeout:
    required: false
    type: integer
    default: 120
    description: "Request timeout in seconds"

  # ============================================================================
  # DEFAULTS
  # ============================================================================

  defaults.model:
    required: false
    type: string
    default: null
    description: "Default model name"
    example: "gpt-4o-mini"

  defaults.temperature:
    required: false
    type: float
    default: 0.2
    description: "Default temperature for generation"

  defaults.max_tokens:
    required: false
    type: integer
    default: null
    description: "Default max tokens (null = provider default)"

  # ============================================================================
  # REQUEST CONFIGURATION
  # ============================================================================

  request.messages_transform:
    required: true
    type: string
    options: ["openai_chat", "cohere_chat", "anthropic_chat", "ollama_chat", "gemini_chat"]
    description: "How to transform messages array for this provider"
    example: "openai_chat"

  request.static_fields:
    required: false
    type: object
    default: {}
    description: "Fields always included in request body"
    example:
      stream: false

  request.param_map:
    required: false
    type: object
    default:
      model: "model"
      temperature: "temperature"
      max_tokens: "max_tokens"
    description: "Maps Fitz parameter names to provider parameter names"

  # ============================================================================
  # RESPONSE CONFIGURATION
  # ============================================================================

  response.content_path:
    required: true
    type: string
    description: "JSONPath to extract response text from API response"
    example: "choices[0].message.content"

  response.is_array:
    required: false
    type: boolean
    default: false
    description: "Whether content_path returns an array"

  response.array_index:
    required: false
    type: integer
    default: 0
    description: "Index to use if content_path returns array"

  response.metadata_paths:
    required: false
    type: object
    default: {}
    description: "Optional paths to extract metadata (tokens, finish_reason)"
    example:
      finish_reason: "choices[0].finish_reason"
      tokens_input: "usage.prompt_tokens"
      tokens_output: "usage.completion_tokens"