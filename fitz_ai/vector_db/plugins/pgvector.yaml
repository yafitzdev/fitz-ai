# fitz_ai/vector_db/plugins/pgvector.yaml
#
# PostgreSQL + pgvector Vector Database Plugin
# =============================================
#
# Unified storage solution using PostgreSQL with the pgvector extension.
# Supports both local mode (embedded pgserver) and external PostgreSQL.
#
# Local mode:
#   - Uses pgserver (pip-installable embedded PostgreSQL)
#   - Zero friction: pip install pgserver
#   - Data stored in ~/.fitz/pgdata/
#
# External mode:
#   - Uses user-provided PostgreSQL connection string
#   - Supports any PostgreSQL with pgvector extension
#
# Features:
#   - HNSW index for 99% recall, zero maintenance
#   - Hybrid search (vector + full-text via tsvector)
#   - Full SQL capabilities
#   - Unified storage for vectors and tables
#
# Install with: pip install psycopg[binary] pgvector pgserver

name: pgvector
type: vector_db
description: PostgreSQL + pgvector - unified local/external storage with HNSW indexing

# =============================================================================
# Provider-specific features
# =============================================================================
features:
  # pgvector accepts any string ID - no conversion needed
  requires_uuid_ids: false

  # No auto-detection - mode is configured explicitly
  auto_detect: null

  # Collections are separate databases - no namespace support needed
  supports_namespaces: false

# =============================================================================
# Connection Configuration
# =============================================================================
connection:
  # Local plugin - delegates to Python implementation
  type: local

# =============================================================================
# Operations
# =============================================================================
operations:
  # Python class that implements the VectorDBPlugin protocol
  # Supports additional kwargs:
  #   - mode: "local" (pgserver) or "external" (connection_string)
  #   - data_dir: Data directory for pgserver (local mode)
  #   - connection_string: PostgreSQL URI (external mode)
  #   - hnsw_m: HNSW max connections per layer (default: 16)
  #   - hnsw_ef_construction: HNSW construction ef (default: 64)
  python_class: fitz_ai.backends.local_vector_db.pgvector.PgVectorDB
