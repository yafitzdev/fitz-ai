# TEMPLATE: Document Chunker Plugin
#
# Chunkers split text into smaller pieces (chunks) for processing.
#
# INPUT:  text (str) - The full text content to split
#         base_meta (Dict) - Metadata containing doc_id, source_file, etc.
#
# OUTPUT: List[Chunk] - List of chunk objects
#
# REQUIRED:
#   - plugin_name: str attribute (unique identifier)
#   - chunk_text() method with signature below
#
# The Chunk class has these attributes:
#   - id: str (unique, typically "{doc_id}:{chunk_index}")
#   - doc_id: str (document identifier from base_meta)
#   - chunk_index: int (0-based position in document)
#   - content: str (the chunk text)
#   - metadata: Dict[str, Any] (copy of base_meta, can add extra fields)

from dataclasses import dataclass, field
from typing import Any, Dict, List

from fitz_ai.core.chunk import Chunk


@dataclass
class ChunkerTemplate:
    """
    Chunker plugins split text into chunks.

    Replace 'ChunkerTemplate' with your plugin class name.
    Replace 'template_chunker' with your plugin_name.
    """

    # REQUIRED: Unique plugin identifier
    plugin_name: str = field(default="template_chunker", repr=False)

    # Add your configuration parameters here, for example:
    # chunk_size: int = 1000
    # chunk_overlap: int = 100

    def chunk_text(self, text: str, base_meta: Dict[str, Any]) -> List[Chunk]:
        """
        Split text into chunks.

        Args:
            text: The text content to chunk. May be empty.
            base_meta: Metadata dict with 'doc_id' or 'source_file'.

        Returns:
            List of Chunk objects. Return empty list for empty input.
        """
        # Handle empty input
        if not text or not text.strip():
            return []

        # Get document ID from metadata
        doc_id = str(base_meta.get("doc_id") or base_meta.get("source_file") or "unknown")

        # TODO: Implement your chunking logic here
        # Create chunks and return them
        chunks: List[Chunk] = []

        # Example: Create a single chunk (replace with your logic)
        chunks.append(
            Chunk(
                id=f"{doc_id}:0",
                doc_id=doc_id,
                chunk_index=0,
                content=text.strip(),
                metadata=dict(base_meta),
            )
        )

        return chunks
