# fitz_ai/engines/fitz_rag/retrieval/plugins/dense.yaml
#
# Dense Retrieval Plugin
#
# This YAML file defines the retrieval pipeline for dense (vector) search.
# The steps reference standard Python step classes that are written once
# and reused across different retrieval plugins.
#
# VectorSearchStep has built-in:
# - Multi-query expansion for long queries (automatic, no config needed)
# - Keyword filtering for exact term matching (automatic, no config needed)
# - Deduplication of results (automatic, no config needed)

plugin_name: dense
description: "Dense retrieval with intelligent vector search"

# Pipeline steps - executed in order
# Each step references a Python class in fitz_ai.engines.fitz_rag.retrieval.steps
steps:
  - type: artifact_fetch       # Fetch artifacts first (always included)
    enabled_if: fetch_artifacts

  - type: vector_search        # Intelligent vector search (multi-query + keyword baked in)
    k: 25                      # Candidates to retrieve

  - type: rerank
    k: 10                      # Top-k after reranking
    enabled_if: reranker       # Only run if reranker dependency is provided

  - type: limit
    k: 5                       # Final chunks returned (uses retrieval.top_k from config)
    use_config: top_k          # Override k with value from retrieval config
